<!DOCTYPE html><html lang="zh-Hant"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¢ç©¶æº«åº¦å°æº¶è§£é€Ÿç‡çš„å½±éŸ¿</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/regression@2.0.1/dist/regression.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        secondary: '#42B883',
                        accent: '#FF6B6B',
                        info: '#4FC3F7',
                        warning: '#FFB74D'
                    },
                    fontFamily: {
                        'sans': ['Noto Sans TC', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .dark .glass-effect {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }
        
        @media (max-width: 768px) {
            .chart-container {
                height: 300px;
            }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <!-- æš—é»‘æ¨¡å¼æª¢æ¸¬ -->
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>

    <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800">
        <!-- æ¨™é¡Œå€åŸŸ -->
        <div class="gradient-bg text-white py-12 px-4">
            <div class="max-w-7xl mx-auto">
                <div class="flex flex-col lg:flex-row items-center justify-between">
                    <div class="lg:w-1/2 mb-8 lg:mb-0">
                        <h1 class="text-4xl lg:text-5xl font-bold mb-4 animate-float">
                            ğŸ§ª æ¢ç©¶æº«åº¦å°æº¶è§£é€Ÿç‡çš„å½±éŸ¿
                        </h1>
                        <p class="text-xl opacity-90">
                            ä½¿ç”¨ç·šæ€§è¿´æ­¸æ¨¡å‹åˆ†ææº«åº¦èˆ‡æº¶è§£æ™‚é–“çš„é—œä¿‚
                        </p>
                    </div>
                    <div class="lg:w-1/2 flex justify-center">
                        <img src="https://imagedb.museum.eduhk.hk/media/7a/f9/c5/7af9c528e521498f96664195ba08c54d.jpg" alt="å¯¦é©—ç‡’æ¯" class="w-64 h-64 rounded-full object-cover shadow-2xl animate-float" style="animation-delay: 0.5s">
                    </div>
                </div>
            </div>
        </div>

        <div class="max-w-7xl mx-auto px-4 py-8">
            <!-- ä½¿ç”¨èªªæ˜ -->
            <div class="mb-8">
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 border border-gray-200 dark:border-gray-700">
                    <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-4 flex items-center">
                        ğŸ“š å¦‚ä½•ä½¿ç”¨
                    </h2>
                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="bg-red-50 dark:bg-red-900/20 p-4 rounded-xl border-l-4 border-red-500">
                            <div class="font-semibold text-red-700 dark:text-red-400 mb-2">æ­¥é©Ÿ 1</div>
                            <p class="text-red-600 dark:text-red-300 text-sm">è¼¸å…¥æº¶åŠ‘èµ·å§‹æº«åº¦å’Œæº¶è§£æ™‚é–“ï¼Œé»æ“ŠåŠ å…¥æ•¸æ“š</p>
                        </div>
                        <div class="bg-orange-50 dark:bg-orange-900/20 p-4 rounded-xl border-l-4 border-orange-500">
                            <div class="font-semibold text-orange-700 dark:text-orange-400 mb-2">æ­¥é©Ÿ 2</div>
                            <p class="text-orange-600 dark:text-orange-300 text-sm">é»æ“Šè¨“ç·´æ¨¡å‹ï¼Œç³»çµ±å°‡åˆ†ææ•¸æ“šä¸¦å±•ç¤ºåœ–è¡¨</p>
                        </div>
                        <div class="bg-purple-50 dark:bg-purple-900/20 p-4 rounded-xl border-l-4 border-purple-500">
                            <div class="font-semibold text-purple-700 dark:text-purple-400 mb-2">æ­¥é©Ÿ 3</div>
                            <p class="text-purple-600 dark:text-purple-300 text-sm">è¨˜éŒ„è‡³å°‘3å€‹ä¸åŒæ•¸æ“šé»ï¼Œç²å¾—æ›´æº–ç¢ºçµæœ</p>
                        </div>
                        <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border-l-4 border-blue-500">
                            <div class="font-semibold text-blue-700 dark:text-blue-400 mb-2">æ­¥é©Ÿ 4</div>
                            <p class="text-blue-600 dark:text-blue-300 text-sm">åœ¨é æ¸¬å€è¼¸å…¥æ–°æº«åº¦ï¼Œé æ¸¬æº¶è§£æ™‚é–“</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¸»è¦åŠŸèƒ½å€åŸŸ -->
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- æ•¸æ“šè¼¸å…¥å€ -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 border border-gray-200 dark:border-gray-700">
                    <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-6 flex items-center">
                        ğŸ“Š æ•¸æ“šè¼¸å…¥
                    </h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                æº¶åŠ‘èµ·å§‹æº«åº¦ (Â°C)
                            </label>
                            <input type="number" id="temp" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-all" placeholder="ä¾‹å¦‚ï¼š25">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                æº¶è§£æ™‚é–“ (ç§’)
                            </label>
                            <input type="number" id="time" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-all" placeholder="ä¾‹å¦‚ï¼š120">
                        </div>
                        
                        <div class="flex flex-wrap gap-3 pt-4">
                            <button onclick="addData()" class="flex-1 min-w-0 bg-red-500 hover:bg-red-600 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 shadow-lg">
                                ğŸ“ åŠ å…¥æ•¸æ“š
                            </button>
                            <button onclick="trainModel()" class="flex-1 min-w-0 bg-purple-500 hover:bg-purple-600 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 shadow-lg">
                                ğŸ¤– è¨“ç·´æ¨¡å‹
                            </button>
                            <button onclick="clearData()" class="flex-1 min-w-0 bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 shadow-lg">
                                ğŸ—‘ï¸ æ¸…ç©º
                            </button>
                        </div>
                    </div>

                    <!-- æ•¸æ“šåˆ—è¡¨ -->
                    <div class="mt-6">
                        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">å·²è¼¸å…¥çš„æ•¸æ“š:</h4>
                        <div id="dataList" class="bg-gray-50 dark:bg-gray-700 rounded-xl p-4 max-h-40 overflow-y-auto">
                            <p class="text-gray-500 dark:text-gray-400 text-sm">å°šç„¡æ•¸æ“š</p>
                        </div>
                    </div>

                    <!-- é æ¸¬å€ -->
                    <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-600">
                        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">ğŸ”® é æ¸¬æº¶è§£æ™‚é–“</h4>
                        <div class="flex gap-3">
                            <input type="number" id="newTemp" class="flex-1 px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="æ–°çš„æº«åº¦ (Â°C)">
                            <button onclick="predict()" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 shadow-lg">
                                é æ¸¬
                            </button>
                        </div>
                        <div id="predictionResult" class="mt-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-xl text-blue-800 dark:text-blue-200 font-semibold hidden"></div>
                    </div>

                    <!-- ç§‘å­¸å•ç­”åŠ©æ‰‹ -->
                    <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-600">
                        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center">
                            ğŸ¤– ç§‘å­¸å•ç­”åŠ©æ‰‹
                            <span class="ml-2 px-2 py-1 text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-full">
                                åƒ…å›ç­”ç§‘å­¸å•é¡Œ
                            </span>
                        </h4>
                        
                        <!-- èŠå¤©è¨˜éŒ„ -->
                        <div id="chatHistory" class="bg-gray-50 dark:bg-gray-700 rounded-xl p-4 max-h-96 overflow-y-auto mb-4 min-h-32">
                            <div class="flex items-start space-x-3 mb-4">
                                <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-sm font-bold">
                                    ğŸ¤–
                                </div>
                                <div class="flex-1 bg-white dark:bg-gray-600 rounded-lg p-3 shadow-sm">
                                    <p class="text-gray-800 dark:text-gray-200 text-sm">
                                        ä½ å¥½ï¼æˆ‘æ˜¯ç§‘å­¸å•ç­”åŠ©æ‰‹ã€‚æˆ‘å¯ä»¥å›ç­”é—œæ–¼åŒ–å­¸ã€ç‰©ç†ã€æº¶è§£ã€æº«åº¦ç­‰ç§‘å­¸ç›¸é—œçš„å•é¡Œã€‚æœ‰ä»€éº¼ç§‘å­¸å•é¡Œæƒ³è¦äº†è§£å—ï¼Ÿ
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- è¼¸å…¥å€ -->
                        <div class="flex gap-3">
                            <input type="text" id="scienceQuestion" class="flex-1 px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="å•ä¸€å€‹ç§‘å­¸å•é¡Œ...">
                            <button onclick="askScienceQuestion()" id="askButton" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 shadow-lg">
                                ğŸš€ æå•
                            </button>
                        </div>
                        
                        <!-- å»ºè­°å•é¡Œ -->
                        <div class="mt-3">
                            <p class="text-xs text-gray-500 dark:text-gray-400 mb-2">ğŸ’¡ å»ºè­°å•é¡Œï¼š</p>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="fillSampleQuestion('ç‚ºä»€éº¼æº«åº¦æœƒå½±éŸ¿æº¶è§£é€Ÿç‡ï¼Ÿ')" class="px-3 py-1 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 rounded-full hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-colors">
                                    æº¶è§£åŸç†
                                </button>
                                <button onclick="fillSampleQuestion('ä»€éº¼æ˜¯ç·šæ€§è¿´æ­¸ï¼Ÿ')" class="px-3 py-1 text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 rounded-full hover:bg-purple-200 dark:hover:bg-purple-900/50 transition-colors">
                                    çµ±è¨ˆåˆ†æ
                                </button>
                                <button onclick="fillSampleQuestion('åˆ†å­é‹å‹•ç†è«–æ˜¯ä»€éº¼ï¼Ÿ')" class="px-3 py-1 text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-full hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors">
                                    åˆ†å­ç†è«–
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- åœ–è¡¨å’Œç†è«–å€ -->
                <div class="space-y-6">
                    <!-- åœ–è¡¨ -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 border border-gray-200 dark:border-gray-700">
                        <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4 flex items-center">
                            ğŸ“ˆ æ•¸æ“šåœ–è¡¨
                        </h3>
                        <div class="chart-container">
                            <canvas id="regressionChart"></canvas>
                        </div>
                        <div id="modelInfo" class="mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-xl hidden">
                            <h5 class="font-semibold text-gray-700 dark:text-gray-300 mb-2">æ¨¡å‹ä¿¡æ¯:</h5>
                            <div id="equationDisplay" class="text-sm text-gray-600 dark:text-gray-400"></div>
                            <div id="r2Display" class="text-sm text-gray-600 dark:text-gray-400"></div>
                        </div>
                    </div>

                    <!-- ç†è«–èªªæ˜ -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 border border-gray-200 dark:border-gray-700">
                        <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4 flex items-center">
                            ğŸ§® ç·šæ€§è¿´æ­¸ç†è«–
                        </h3>
                        <div class="mb-4 text-center">
                            <img src="https://developers.google.com/static/machine-learning/crash-course/linear-regression/images/equation.png?hl=zh-tw" alt="ç·šæ€§è¿´æ­¸å…¬å¼" class="mx-auto rounded-lg shadow-md max-w-full h-auto">
                        </div>
                        <div class="space-y-3 text-gray-600 dark:text-gray-300">
                            <p class="bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg">
                                ğŸ“ ç·šæ€§è¿´æ­¸æ˜¯ä¸€ç¨®è³‡æ–™åˆ†ææŠ€è¡“ï¼Œå¯ä½¿ç”¨å¦ä¸€å€‹ç›¸é—œä¸”å·²çŸ¥çš„è³‡æ–™å€¼ä¾†é æ¸¬æœªçŸ¥è³‡æ–™çš„å€¼ã€‚
                            </p>
                            <p class="bg-green-50 dark:bg-green-900/20 p-3 rounded-lg">
                                ğŸ¯ ç·šæ€§è¿´æ­¸æ¨¡å‹ç›¸å°ç°¡å–®ï¼Œä¸¦å¯æä¾›æ˜“æ–¼è§£é‡‹çš„æ•¸å­¸å…¬å¼ä¾†ç”¢ç”Ÿé æ¸¬ã€‚
                            </p>
                            <p class="bg-purple-50 dark:bg-purple-900/20 p-3 rounded-lg">
                                ğŸŒ¡ï¸ æº«åº¦è¶Šé«˜ï¼Œåˆ†å­é‹å‹•è¶Šæ´»èºï¼Œé€šå¸¸æœƒæé«˜æº¶è§£é€Ÿç‡ï¼Œç¸®çŸ­æº¶è§£æ™‚é–“ã€‚
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- éŒ¯èª¤æç¤º -->
            <div id="error" class="mt-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 rounded-xl hidden"></div>
        </div>
    </div>

    <script>
        let data = [];
        let model = null;
        let chart = null;

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            setTimeout(() => {
                errorDiv.classList.add('hidden');
            }, 5000);
        }

        function updateDataList() {
            const dataListDiv = document.getElementById('dataList');
            if (data.length === 0) {
                dataListDiv.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-sm">å°šç„¡æ•¸æ“š</p>';
            } else {
                dataListDiv.innerHTML = data.map((point, index) => 
                    `<div class="flex justify-between items-center py-1 px-2 bg-white dark:bg-gray-600 rounded mb-1">
                        <span class="text-sm">æº«åº¦: ${point[0]}Â°C, æ™‚é–“: ${point[1]}s</span>
                        <button onclick="removeData(${index})" class="text-red-500 hover:text-red-700 text-xs">ç§»é™¤</button>
                    </div>`
                ).join('');
            }
        }

        function removeData(index) {
            data.splice(index, 1);
            updateDataList();
            if (data.length >= 2 && model) {
                trainModel();
            }
        }

        function addData() {
            const temp = parseFloat(document.getElementById('temp').value);
            const time = parseFloat(document.getElementById('time').value);
            
            if (isNaN(temp) || isNaN(time)) {
                showError('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸å­—ã€‚');
                return;
            }
            
            if (temp < -273.15) {
                showError('æº«åº¦ä¸èƒ½ä½æ–¼çµ•å°é›¶åº¦ (-273.15Â°C)ã€‚');
                return;
            }
            
            if (time <= 0) {
                showError('æº¶è§£æ™‚é–“å¿…é ˆå¤§æ–¼ 0ã€‚');
                return;
            }

            data.push([temp, time]);
            document.getElementById('temp').value = '';
            document.getElementById('time').value = '';
            updateDataList();
            
            // æˆåŠŸæç¤º
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'âœ… å·²åŠ å…¥';
            setTimeout(() => {
                button.textContent = originalText;
            }, 1000);
        }

        function trainModel() {
            if (data.length < 2) {
                showError('éœ€è¦è‡³å°‘å…©å€‹æ•¸æ“šé»æ‰èƒ½è¨“ç·´æ¨¡å‹ã€‚');
                return;
            }

            const regressionResult = regression.linear(data);
            model = regressionResult;

            const X = data.map(d => d[0]);
            const y = data.map(d => d[1]);

            drawChart(X, y, regressionResult);
            showModelInfo(regressionResult);
            
            // æˆåŠŸæç¤º
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'âœ… è¨“ç·´å®Œæˆ';
            setTimeout(() => {
                button.textContent = originalText;
            }, 2000);
        }

        function showModelInfo(regressionResult) {
            const modelInfoDiv = document.getElementById('modelInfo');
            const equationDiv = document.getElementById('equationDisplay');
            const r2Div = document.getElementById('r2Display');
            
            const slope = regressionResult.equation[0].toFixed(4);
            const intercept = regressionResult.equation[1].toFixed(4);
            const r2 = regressionResult.r2.toFixed(4);
            
            equationDiv.textContent = `æ–¹ç¨‹å¼: y = ${slope}x + ${intercept}`;
            r2Div.textContent = `æ±ºå®šä¿‚æ•¸ (RÂ²): ${r2} (${(r2 * 100).toFixed(2)}% çš„è®Šç•°å¯è¢«è§£é‡‹)`;
            
            modelInfoDiv.classList.remove('hidden');
        }

        function drawChart(X, y, regressionResult) {
            const ctx = document.getElementById('regressionChart').getContext('2d');

            if (chart) {
                chart.destroy();
            }

            const isDark = document.documentElement.classList.contains('dark');
            
            chart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'å¯¦é©—æ•¸æ“šé»',
                        data: X.map((x, i) => ({ x: x, y: y[i] })),
                        backgroundColor: '#FF6B6B',
                        borderColor: '#FF6B6B',
                        pointRadius: 8,
                        pointHoverRadius: 10
                    }, {
                        label: 'ç·šæ€§è¿´æ­¸æ¨¡å‹',
                        type: 'line',
                        data: X.map(x => ({ x: x, y: regressionResult.equation[0] * x + regressionResult.equation[1] })),
                        borderColor: '#5D5CDE',
                        borderWidth: 3,
                        fill: false,
                        pointRadius: 0,
                        tension: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: isDark ? '#e5e7eb' : '#374151',
                                font: {
                                    size: 12
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'æº¶åŠ‘èµ·å§‹æº«åº¦ (Â°C)',
                                color: isDark ? '#e5e7eb' : '#374151',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                color: isDark ? '#d1d5db' : '#6b7280'
                            },
                            grid: {
                                color: isDark ? '#374151' : '#e5e7eb'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'æº¶è§£æ™‚é–“ (ç§’)',
                                color: isDark ? '#e5e7eb' : '#374151',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                color: isDark ? '#d1d5db' : '#6b7280'
                            },
                            grid: {
                                color: isDark ? '#374151' : '#e5e7eb'
                            }
                        }
                    }
                }
            });
        }

        function predict() {
            const newTemp = parseFloat(document.getElementById('newTemp').value);
            const resultDiv = document.getElementById('predictionResult');
            
            if (isNaN(newTemp)) {
                showError('è«‹è¼¸å…¥æœ‰æ•ˆçš„æº«åº¦æ•¸å€¼ã€‚');
                return;
            }
            
            if (!model) {
                showError('è«‹å…ˆè¨“ç·´æ¨¡å‹ã€‚');
                return;
            }
            
            if (newTemp < -273.15) {
                showError('æº«åº¦ä¸èƒ½ä½æ–¼çµ•å°é›¶åº¦ (-273.15Â°C)ã€‚');
                return;
            }

            const predictedTime = model.equation[0] * newTemp + model.equation[1];
            
            if (predictedTime < 0) {
                resultDiv.innerHTML = `
                    <div class="flex items-center">
                        <span class="text-2xl mr-2">âš ï¸</span>
                        <div>
                            <div class="font-bold">é æ¸¬çµæœ: ${predictedTime.toFixed(2)} ç§’</div>
                            <div class="text-sm opacity-75">æ³¨æ„ï¼šé æ¸¬çµæœç‚ºè² å€¼ï¼Œå¯èƒ½è¶…å‡ºæ¨¡å‹é©ç”¨ç¯„åœ</div>
                        </div>
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="flex items-center">
                        <span class="text-2xl mr-2">ğŸ¯</span>
                        <div>
                            <div class="font-bold">é æ¸¬æº¶è§£æ™‚é–“: ${predictedTime.toFixed(2)} ç§’</div>
                            <div class="text-sm opacity-75">åœ¨ ${newTemp}Â°C æº«åº¦ä¸‹</div>
                        </div>
                    </div>
                `;
            }
            
            resultDiv.classList.remove('hidden');
            
            // æ¸…ç©ºè¼¸å…¥æ¡†
            document.getElementById('newTemp').value = '';
        }

        function clearData() {
            data = [];
            model = null;
            document.getElementById('predictionResult').classList.add('hidden');
            document.getElementById('modelInfo').classList.add('hidden');
            updateDataList();

            if (chart) {
                chart.destroy();
                chart = null;
            }
            
            // æˆåŠŸæç¤º
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'âœ… å·²æ¸…ç©º';
            setTimeout(() => {
                button.textContent = originalText;
            }, 1000);
        }

        // æ”¯æŒ Enter éµæäº¤
        document.getElementById('temp').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('time').focus();
            }
        });

        document.getElementById('time').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addData();
            }
        });

        document.getElementById('newTemp').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                predict();
            }
        });

        // åˆå§‹åŒ–æ•¸æ“šåˆ—è¡¨
        updateDataList();

        // === ç§‘å­¸å•ç­”åŠ©æ‰‹åŠŸèƒ½ ===
        
        // è¨»å†ŠèŠå¤©æ©Ÿå™¨äººå›æ‡‰è™•ç†å™¨
        if (window.Poe && window.Poe.registerHandler) {
            window.Poe.registerHandler("science-chat-handler", (result, context) => {
                const chatHistory = document.getElementById('chatHistory');
                const askButton = document.getElementById('askButton');
                
                if (result.responses && result.responses.length > 0) {
                    const response = result.responses[0];
                    
                    // æ‰¾åˆ°å°æ‡‰çš„æ©Ÿå™¨äººå›æ‡‰å…ƒç´ 
                    let botMessageDiv = document.querySelector(`[data-message-id="${response.messageId}"]`);
                    
                    if (!botMessageDiv) {
                        // å‰µå»ºæ–°çš„æ©Ÿå™¨äººå›æ‡‰å…ƒç´ 
                        const botMessageHTML = `
                            <div class="flex items-start space-x-3 mb-4" data-message-id="${response.messageId}">
                                <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-sm font-bold">
                                    ğŸ¤–
                                </div>
                                <div class="flex-1 bg-white dark:bg-gray-600 rounded-lg p-3 shadow-sm">
                                    <div class="bot-content text-gray-800 dark:text-gray-200 text-sm"></div>
                                    <div class="bot-status text-xs text-gray-500 dark:text-gray-400 mt-2"></div>
                                </div>
                            </div>
                        `;
                        chatHistory.insertAdjacentHTML('beforeend', botMessageHTML);
                        botMessageDiv = document.querySelector(`[data-message-id="${response.messageId}"]`);
                    }
                    
                    const contentDiv = botMessageDiv.querySelector('.bot-content');
                    const statusDiv = botMessageDiv.querySelector('.bot-status');
                    
                    if (response.status === "error") {
                        contentDiv.innerHTML = `<span class="text-red-500">æŠ±æ­‰ï¼Œç™¼ç”ŸéŒ¯èª¤ï¼š${response.statusText || 'ç„¡æ³•å›æ‡‰'}</span>`;
                        statusDiv.textContent = '';
                        askButton.disabled = false;
                        askButton.textContent = 'ğŸš€ æå•';
                    } else if (response.status === "incomplete") {
                        // é¡¯ç¤ºæµå¼å›æ‡‰
                        contentDiv.innerHTML = formatMarkdown(response.content);
                        statusDiv.innerHTML = '<span class="inline-flex items-center"><span class="animate-pulse mr-1">â—</span>æ­£åœ¨å›æ‡‰ä¸­...</span>';
                    } else if (response.status === "complete") {
                        // é¡¯ç¤ºå®Œæˆçš„å›æ‡‰
                        contentDiv.innerHTML = formatMarkdown(response.content);
                        statusDiv.textContent = '';
                        askButton.disabled = false;
                        askButton.textContent = 'ğŸš€ æå•';
                    }
                    
                    // æ»¾å‹•åˆ°æœ€æ–°æ¶ˆæ¯
                    chatHistory.scrollTop = chatHistory.scrollHeight;
                }
            });
        }

        // ç°¡å–®çš„Markdownæ ¼å¼åŒ–å‡½æ•¸
        function formatMarkdown(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/`(.*?)`/g, '<code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">$1</code>')
                .replace(/\n/g, '<br>');
        }

        // æª¢æŸ¥æ˜¯å¦ç‚ºç§‘å­¸ç›¸é—œå•é¡Œ
        function isScienceRelated(question) {
            const scienceKeywords = [
                // åŒ–å­¸ç›¸é—œ
                'åŒ–å­¸', 'åˆ†å­', 'åŸå­', 'å…ƒç´ ', 'åŒ–åˆç‰©', 'åæ‡‰', 'æº¶è§£', 'æº¶æ¶²', 'æ¿ƒåº¦', 'é…¸é¹¼', 'å‚¬åŒ–åŠ‘', 'phå€¼', 'é›¢å­',
                // ç‰©ç†ç›¸é—œ  
                'ç‰©ç†', 'æº«åº¦', 'ç†±åŠ›å­¸', 'èƒ½é‡', 'å‹•èƒ½', 'ä½èƒ½', 'åŠ›', 'é€Ÿåº¦', 'åŠ é€Ÿåº¦', 'é‡åŠ›', 'å£“åŠ›', 'å¯†åº¦',
                // æ•¸å­¸/çµ±è¨ˆç›¸é—œ
                'è¿´æ­¸', 'çµ±è¨ˆ', 'æ•¸å­¸', 'æ–¹ç¨‹å¼', 'å‡½æ•¸', 'è®Šæ•¸', 'ä¿‚æ•¸', 'ç›¸é—œæ€§', 'æ©Ÿç‡', 'æ¨™æº–å·®',
                // å¯¦é©—ç›¸é—œ
                'å¯¦é©—', 'æ•¸æ“š', 'æ¸¬é‡', 'èª¤å·®', 'ç²¾ç¢ºåº¦', 'è®Šå› ', 'æ§åˆ¶çµ„', 'å¯¦é©—çµ„',
                // ä¸€èˆ¬ç§‘å­¸è©å½™
                'ç§‘å­¸', 'ç†è«–', 'å‡è¨­', 'å®šå¾‹', 'åŸç†', 'æ¨¡å‹', 'ç ”ç©¶', 'åˆ†æ', 'è§€å¯Ÿ', 'é æ¸¬'
            ];
            
            const lowerQuestion = question.toLowerCase();
            return scienceKeywords.some(keyword => 
                lowerQuestion.includes(keyword) || 
                lowerQuestion.includes(keyword.toLowerCase())
            );
        }

        // ç™¼é€ç§‘å­¸å•é¡Œ
        async function askScienceQuestion() {
            const questionInput = document.getElementById('scienceQuestion');
            const question = questionInput.value.trim();
            const chatHistory = document.getElementById('chatHistory');
            const askButton = document.getElementById('askButton');
            
            if (!question) {
                showError('è«‹è¼¸å…¥å•é¡Œã€‚');
                return;
            }
            
            // æª¢æŸ¥æ˜¯å¦ç‚ºç§‘å­¸ç›¸é—œå•é¡Œ
            if (!isScienceRelated(question)) {
                showError('æŠ±æ­‰ï¼Œæˆ‘åªèƒ½å›ç­”ç§‘å­¸ç›¸é—œçš„å•é¡Œã€‚è«‹å•é—œæ–¼åŒ–å­¸ã€ç‰©ç†ã€æ•¸å­¸ã€å¯¦é©—ç­‰ç§‘å­¸ä¸»é¡Œçš„å•é¡Œã€‚');
                return;
            }
            
            // æª¢æŸ¥Poe APIæ˜¯å¦å¯ç”¨
            if (!window.Poe || !window.Poe.sendUserMessage) {
                showError('èŠå¤©åŠŸèƒ½æš«æ™‚ç„¡æ³•ä½¿ç”¨ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
                return;
            }
            
            // æ·»åŠ ç”¨æˆ¶æ¶ˆæ¯åˆ°èŠå¤©è¨˜éŒ„
            const userMessageHTML = `
                <div class="flex items-start space-x-3 mb-4 justify-end">
                    <div class="flex-1 bg-blue-100 dark:bg-blue-900/30 rounded-lg p-3 shadow-sm max-w-xs ml-auto">
                        <p class="text-gray-800 dark:text-gray-200 text-sm">${question}</p>
                    </div>
                    <div class="w-8 h-8 bg-gradient-to-r from-green-500 to-blue-600 rounded-full flex items-center justify-center text-white text-sm font-bold">
                        ğŸ‘¤
                    </div>
                </div>
            `;
            chatHistory.insertAdjacentHTML('beforeend', userMessageHTML);
            
            // æ¸…ç©ºè¼¸å…¥æ¡†ä¸¦ç¦ç”¨æŒ‰éˆ•
            questionInput.value = '';
            askButton.disabled = true;
            askButton.textContent = 'ğŸ¤” æ€è€ƒä¸­...';
            
            // æ»¾å‹•åˆ°æœ€æ–°æ¶ˆæ¯
            chatHistory.scrollTop = chatHistory.scrollHeight;
            
            try {
                // ç™¼é€æ¶ˆæ¯çµ¦Claudeï¼Œä¸¦æŒ‡å®šåªå›ç­”ç§‘å­¸å•é¡Œ
                const prompt = `@Claude-Sonnet-4 ä½ æ˜¯ä¸€å€‹ç§‘å­¸æ•™å­¸åŠ©æ‰‹ï¼Œå°ˆé–€å›ç­”åŒ–å­¸ã€ç‰©ç†ã€æ•¸å­¸ã€å¯¦é©—ç­‰ç§‘å­¸ç›¸é—œå•é¡Œã€‚è«‹ç”¨ç¹é«”ä¸­æ–‡å›ç­”ä»¥ä¸‹å•é¡Œï¼Œä¸¦ä¿æŒå›ç­”ç°¡æ½”æ˜ç­ã€é©åˆå­¸ç”Ÿç†è§£ï¼š

å•é¡Œï¼š${question}

è«‹ç¢ºä¿å›ç­”å…§å®¹æº–ç¢ºä¸”å…·æœ‰æ•™è‚²åƒ¹å€¼ã€‚å¦‚æœå•é¡Œä¸æ˜¯ç§‘å­¸ç›¸é—œçš„ï¼Œè«‹ç¦®è²Œåœ°èªªæ˜ä½ åªèƒ½å›ç­”ç§‘å­¸å•é¡Œã€‚`;
                
                await window.Poe.sendUserMessage(prompt, {
                    handler: "science-chat-handler",
                    stream: true,
                    openChat: false
                });
                
            } catch (err) {
                console.error('ç™¼é€æ¶ˆæ¯å¤±æ•—:', err);
                askButton.disabled = false;
                askButton.textContent = 'ğŸš€ æå•';
                
                // æ·»åŠ éŒ¯èª¤æ¶ˆæ¯
                const errorMessageHTML = `
                    <div class="flex items-start space-x-3 mb-4">
                        <div class="w-8 h-8 bg-red-500 rounded-full flex items-center justify-center text-white text-sm font-bold">
                            âŒ
                        </div>
                        <div class="flex-1 bg-red-50 dark:bg-red-900/20 rounded-lg p-3 shadow-sm">
                            <p class="text-red-700 dark:text-red-400 text-sm">
                                æŠ±æ­‰ï¼Œç„¡æ³•ç™¼é€å•é¡Œã€‚è«‹ç¨å¾Œå†è©¦ã€‚
                            </p>
                        </div>
                    </div>
                `;
                chatHistory.insertAdjacentHTML('beforeend', errorMessageHTML);
                chatHistory.scrollTop = chatHistory.scrollHeight;
            }
        }

        // å¡«å…¥ç¯„ä¾‹å•é¡Œ
        function fillSampleQuestion(question) {
            document.getElementById('scienceQuestion').value = question;
        }

        // ç‚ºç§‘å­¸å•é¡Œè¼¸å…¥æ¡†æ·»åŠ Enteréµæ”¯æ´
        document.getElementById('scienceQuestion').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                askScienceQuestion();
            }
        });
    </script>


</body></html>
