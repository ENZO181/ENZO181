<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>溶解時間預測</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/regression@2.0.1/dist/regression.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; }
        .container { max-width: 800px; margin: auto; padding: 20px; }
        input { margin: 5px; }
        button { margin: 5px; }
        .error { color: red; }
    </style>
</head>
<body>
    <div class="container">
        <h1>溶解時間預測</h1>
        <input type="number" id="temp" placeholder="溶劑起始溫度 (°C)" required>
        <input type="number" id="time" placeholder="溶解時間 (s)" required>
        <button onclick="addData()">加入數據</button>
        <button onclick="trainModel()">開始訓練模型</button>
        <button onclick="clearData()">清空</button>

        <h2>預測</h2>
        <input type="number" id="newTemp" placeholder="新的溫度 (°C)" required>
        <button onclick="predict()">預測溶解速率</button>
        
        <div id="predictionResult"></div>
        <canvas id="regressionChart" width="400" height="200"></canvas>
        <div id="error" class="error"></div>
    </div>

    <script>
        let data = [];
        let model = null;
        let chart = null;

        function addData() {
            const temp = parseFloat(document.getElementById('temp').value);
            const time = parseFloat(document.getElementById('time').value);
            if (!isNaN(temp) && !isNaN(time)) {
                data.push([temp, time]);
                document.getElementById('temp').value = '';
                document.getElementById('time').value = '';
                document.getElementById('error').textContent = '';
            } else {
                document.getElementById('error').textContent = '請輸入有效的數字。';
            }
        }

        function trainModel() {
            if (data.length < 2) {
                document.getElementById('error').textContent = '需要至少兩個數據點才能訓練模型。';
                return;
            }

            const regressionResult = regression.linear(data);
            model = regressionResult;

            const X = data.map(d => d[0]);
            const y = data.map(d => d[1]);

            drawChart(X, y, regressionResult);
        }

        function drawChart(X, y, regressionResult) {
            const ctx = document.getElementById('regressionChart').getContext('2d');

            if (chart) {
                chart.destroy();
            }

            chart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: '數據點',
                        data: X.map((x, i) => ({ x: x, y: y[i] })),
                        backgroundColor: 'blue',
                        pointRadius: 5
                    },
                    {
                        label: '線性回歸模型',
                        type: 'line',
                        data: X.map(x => ({ x: x, y: regressionResult.equation[0] * x + regressionResult.equation[1] })),
                        borderColor: 'red',
                        borderWidth: 2,
                        fill: false,
                        pointRadius: 0
                    }]
                },
                options: {
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: '溫度 (°C)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '溶解時間 (s)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true
                        }
                    }
                }
            });
        }


        function predict() {
            const newTemp = parseFloat(document.getElementById('newTemp').value);
            if (model) {
                const predictedTime = model.equation[0] * newTemp + model.equation[1];
                document.getElementById('predictionResult').textContent = `預測溶解時間: ${predictedTime.toFixed(2)} s`;
            } else {
                document.getElementById('error').textContent = '請先訓練模型。';
            }
        }

        function clearData() {
            data = [];
            model = null;
            document.getElementById('predictionResult').textContent = '';
            document.getElementById('error').textContent = '';

            if (chart) {
                chart.destroy();
                chart = null;
            }
        }
    </script>
</body>
</html>